<button id="generate-pdf-btn" style="
    padding: 12px 24px;
    background: #0073aa;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    transition: all 0.3s ease;
">
    üìÑ T√©l√©charger le PDF
</button>

<div id="pdf-status" style="margin-top: 10px; font-size: 14px;"></div>

<script>
(function() {
    'use strict';

    // ‚ö†Ô∏è REMPLACEZ CETTE URL PAR L'URL DE VOTRE SERVEUR
    const API_URL = 'https://votre-serveur.com/generate-pdf';
    // Exemples :
    // - 'https://pdf-api.groupemagellim.com/generate-pdf'
    // - 'http://votre-ip:3000/generate-pdf'

    document.addEventListener('DOMContentLoaded', function() {
        const btn = document.getElementById('generate-pdf-btn');
        const status = document.getElementById('pdf-status');

        if (!btn) return;

        btn.addEventListener('click', async function() {
            // D√©sactive le bouton pendant la g√©n√©ration
            btn.disabled = true;
            btn.style.opacity = '0.6';
            btn.style.cursor = 'not-allowed';
            btn.textContent = '‚è≥ G√©n√©ration en cours...';

            status.textContent = 'G√©n√©ration du PDF, cela peut prendre 10-15 secondes...';
            status.style.color = '#0073aa';

            try {
                // Appel √† l'API avec l'URL de la page actuelle
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        url: window.location.href // URL de la page WordPress actuelle
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error || 'Erreur lors de la g√©n√©ration du PDF');
                }

                // R√©cup√®re le PDF
                const blob = await response.blob();

                // Extrait le nom du fichier depuis les headers (si disponible)
                const contentDisposition = response.headers.get('Content-Disposition');
                let fileName = 'document-magellim.pdf';
                if (contentDisposition) {
                    const match = contentDisposition.match(/filename="(.+)"/);
                    if (match) fileName = match[1];
                }

                // Cr√©e un lien de t√©l√©chargement
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();

                // Nettoie
                setTimeout(() => {
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                }, 100);

                // Message de succ√®s
                status.textContent = '‚úÖ PDF t√©l√©charg√© avec succ√®s !';
                status.style.color = '#00a32a';

            } catch (error) {
                console.error('Erreur g√©n√©ration PDF:', error);
                status.innerHTML = '‚ùå Erreur : ' + error.message + '<br><small>V√©rifiez que le serveur API est accessible.</small>';
                status.style.color = '#d63638';
            } finally {
                // R√©active le bouton
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.style.cursor = 'pointer';
                btn.textContent = 'üìÑ T√©l√©charger le PDF';

                // Efface le message apr√®s 5 secondes
                setTimeout(() => {
                    status.textContent = '';
                }, 5000);
            }
        });
    });
})();
</script>